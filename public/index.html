<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>TikTok Live Chat (with Voice)</title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; text-align: center; }
    #chat { max-width:600px; margin:20px auto; overflow-y: auto; height: 350px; background:#222; padding:10px; border-radius:5px; }
    .msg { text-align: left; margin:5px 0; padding:8px; background:#333; border-radius:4px; }
    input, select, button { margin: 5px; padding: 8px; border-radius: 5px; border: none; }
    button { background:#0a84ff; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <h2>üü£ TikTok Live Chat (‡∏û‡∏π‡∏î‡πÑ‡∏î‡πâ)</h2>

  <div>
    <input id="uniqueId" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok" />
    <button id="btn">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</button>
    <label>
      ‡πÄ‡∏™‡∏µ‡∏¢‡∏á:
      <select id="voiceSelect"></select>
    </label>
  </div>

  <div id="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
  <div id="chat"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const voiceSelect = document.getElementById('voiceSelect');
    let voices = [];

    // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    function loadVoices() {
      voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = voices
        .map(v => `<option value="${v.name}">${v.name} (${v.lang})</option>`)
        .join('');
    }
    speechSynthesis.onvoiceschanged = loadVoices;

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ TikTok Live
    document.getElementById('btn').onclick = () => {
      const uid = document.getElementById('uniqueId').value.trim();
      if (!uid) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ TikTok');
      document.getElementById('status').textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...';
      socket.emit('start', { uniqueId: uid });
    };

    socket.on('connected', data => {
      document.getElementById('status').textContent = '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ roomId: ' + data.roomId;
    });

    socket.on('chat', data => {
      const div = document.createElement('div');
      div.className = 'msg';
      div.textContent = `${data.nickname}: ${data.comment}`;
      document.getElementById('chat').appendChild(div);
      document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;

      speak(`${data.comment}`);
    });

    socket.on('error', err => {
      document.getElementById('status').textContent = '‚ùå ' + err.msg;
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      const selectedName = voiceSelect.value;
      utter.voice = voices.find(v => v.name === selectedName);
      utter.lang = utter.voice?.lang || 'th-TH';
      utter.rate = 1; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏õ‡∏Å‡∏ï‡∏¥
      speechSynthesis.speak(utter);
    }
  </script>
</body>
</html>
